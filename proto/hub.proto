syntax = "proto3";
package nekkus;
import "proto/module.proto";
option go_package = "github.com/GalitskyKK/nekkus-core/pkg/protocol";

service NekkusHub {
  rpc Register(ModuleInfo) returns (RegisterResponse);
  rpc PublishEvent(DataEvent) returns (PublishResponse);
  rpc SubscribeEvents(SubscribeRequest) returns (stream DataEvent);
  rpc CrossQuery(CrossQueryRequest) returns (QueryResponse);
  rpc CrossExecute(CrossExecuteRequest) returns (ExecuteResponse);
}

message RegisterResponse {
  bool success = 1;
  string hub_id = 2;
  map<string, string> config = 3;
}

message PublishResponse {
  bool success = 1;
}

message SubscribeRequest {
  string subscriber_id = 1;
  repeated string topics = 2;
  repeated string source_modules = 3;
}

message CrossQueryRequest {
  string source_module = 1;
  string target_module = 2;
  QueryRequest query = 3;
}

message CrossExecuteRequest {
  string source_module = 1;
  string target_module = 2;
  ExecuteRequest request = 3;
}